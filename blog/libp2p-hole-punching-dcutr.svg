<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="727.0687px" preserveAspectRatio="none" style="width:1287px;height:727px;" version="1.1" viewBox="0 0 1287 727" width="1287.1809px" zoomAndPan="magnify"><defs><filter height="300%" id="f1nymm6qx9hc0t" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="3.590462833099579"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="7.180925666199158" dy="7.180925666199158" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1nymm6qx9hc0t)" height="525.0351" style="stroke: #000000; stroke-width: 3.590462833099579;" width="1244.0954" x="23.338" y="99.2707"/><rect fill="#FFFFFF" filter="url(#f1nymm6qx9hc0t)" height="469.1445" style="stroke: #000000; stroke-width: 3.590462833099579;" width="810.547" x="41.2903" y="142.5947"/><rect fill="#FFFFFF" filter="url(#f1nymm6qx9hc0t)" height="247.1388" style="stroke: #000000; stroke-width: 3.590462833099579;" width="774.6424" x="59.2426" y="185.9187"/><line style="stroke: #A80036; stroke-width: 1.7952314165497896; stroke-dasharray: 5.0,5.0;" x1="222.6087" x2="222.6087" y1="68.7518" y2="654.8247"/><line style="stroke: #A80036; stroke-width: 1.7952314165497896; stroke-dasharray: 5.0,5.0;" x1="314.1655" x2="314.1655" y1="68.7518" y2="654.8247"/><line style="stroke: #A80036; stroke-width: 1.7952314165497896; stroke-dasharray: 5.0,5.0;" x1="790.7994" x2="790.7994" y1="68.7518" y2="654.8247"/><rect fill="#FEFECE" filter="url(#f1nymm6qx9hc0t)" height="54.3899" style="stroke: #A80036; stroke-width: 2.6928471248246844;" width="41.2903" x="199.2707" y="5.3857"/><text fill="#000000" font-family="sans-serif" font-size="25.1332" lengthAdjust="spacingAndGlyphs" textLength="16.1571" x="211.8373" y="41.2816">A</text><rect fill="#FEFECE" filter="url(#f1nymm6qx9hc0t)" height="54.3899" style="stroke: #A80036; stroke-width: 2.6928471248246844;" width="41.2903" x="199.2707" y="653.0295"/><text fill="#000000" font-family="sans-serif" font-size="25.1332" lengthAdjust="spacingAndGlyphs" textLength="16.1571" x="211.8373" y="688.9253">A</text><rect fill="#FEFECE" filter="url(#f1nymm6qx9hc0t)" height="54.3899" style="stroke: #A80036; stroke-width: 2.6928471248246844;" width="91.5568" x="265.6942" y="5.3857"/><text fill="#000000" font-family="sans-serif" font-size="25.1332" lengthAdjust="spacingAndGlyphs" textLength="66.4236" x="278.2609" y="41.2816">Relay</text><rect fill="#FEFECE" filter="url(#f1nymm6qx9hc0t)" height="54.3899" style="stroke: #A80036; stroke-width: 2.6928471248246844;" width="91.5568" x="265.6942" y="653.0295"/><text fill="#000000" font-family="sans-serif" font-size="25.1332" lengthAdjust="spacingAndGlyphs" textLength="66.4236" x="278.2609" y="688.9253">Relay</text><rect fill="#FEFECE" filter="url(#f1nymm6qx9hc0t)" height="54.3899" style="stroke: #A80036; stroke-width: 2.6928471248246844;" width="43.0856" x="765.6662" y="5.3857"/><text fill="#000000" font-family="sans-serif" font-size="25.1332" lengthAdjust="spacingAndGlyphs" textLength="17.9523" x="778.2328" y="41.2816">B</text><rect fill="#FEFECE" filter="url(#f1nymm6qx9hc0t)" height="54.3899" style="stroke: #A80036; stroke-width: 2.6928471248246844;" width="43.0856" x="765.6662" y="653.0295"/><text fill="#000000" font-family="sans-serif" font-size="25.1332" lengthAdjust="spacingAndGlyphs" textLength="17.9523" x="778.2328" y="688.9253">B</text><path d="M23.338,99.2707 L1258.4572,99.2707 L1258.4572,111.8373 L1240.5049,129.7896 L23.338,129.7896 L23.338,99.2707 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.7952314165497896;"/><rect fill="none" height="525.0351" style="stroke: #000000; stroke-width: 3.590462833099579;" width="1244.0954" x="23.338" y="99.2707"/><text fill="#000000" font-family="sans-serif" font-size="23.338" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="1154.3338" x="50.2665" y="122.7288">A and B coordinate dial via Direct Connection Upgrade through Relay (DCUtR) Protocol</text><path d="M41.2903,142.5947 L179.5231,142.5947 L179.5231,155.1613 L161.5708,173.1136 L41.2903,173.1136 L41.2903,142.5947 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.7952314165497896;"/><rect fill="none" height="469.1445" style="stroke: #000000; stroke-width: 3.590462833099579;" width="810.547" x="41.2903" y="142.5947"/><text fill="#000000" font-family="sans-serif" font-size="23.338" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="57.4474" x="68.2188" y="166.0528">loop</text><text fill="#000000" font-family="sans-serif" font-size="19.7475" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="421.8794" x="206.4516" y="164.5153">[Until direct connection established]</text><path d="M59.2426,185.9187 L441.6269,185.9187 L441.6269,198.4853 L423.6746,216.4376 L59.2426,216.4376 L59.2426,185.9187 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.7952314165497896;"/><rect fill="none" height="247.1388" style="stroke: #000000; stroke-width: 3.590462833099579;" width="774.6424" x="59.2426" y="185.9187"/><text fill="#000000" font-family="sans-serif" font-size="23.338" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="301.5989" x="86.1711" y="209.3768">Via relayed connection</text><polygon fill="#A80036" points="769.2567,247.4334,787.209,254.6143,769.2567,261.7952,776.4376,254.6143" style="stroke: #A80036; stroke-width: 1.7952314165497896;"/><line style="stroke: #A80036; stroke-width: 1.7952314165497896;" x1="223.5063" x2="780.0281" y1="254.6143" y2="254.6143"/><text fill="#000000" font-family="sans-serif" font-size="23.338" lengthAdjust="spacingAndGlyphs" textLength="263.899" x="236.0729" y="245.5198">Connect { addresses }</text><rect fill="#FBFB77" filter="url(#f1nymm6qx9hc0t)" height="41.2903" style="stroke: #A80036; stroke-width: 1.7952314165497896;" width="292.6227" x="77.195" y="277.9523"/><text fill="#000000" font-family="sans-serif" font-size="23.338" lengthAdjust="spacingAndGlyphs" textLength="278.2609" x="84.3759" y="306.7961">Measure round-trip time</text><polygon fill="#A80036" points="243.2539,359.2146,225.3015,366.3955,243.2539,373.5764,236.0729,366.3955" style="stroke: #A80036; stroke-width: 1.7952314165497896;"/><line style="stroke: #A80036; stroke-width: 1.7952314165497896;" x1="232.4825" x2="789.0042" y1="366.3955" y2="366.3955"/><text fill="#000000" font-family="sans-serif" font-size="23.338" lengthAdjust="spacingAndGlyphs" textLength="263.899" x="254.0252" y="357.301">Connect { addresses }</text><polygon fill="#A80036" points="769.2567,411.5147,787.209,418.6957,769.2567,425.8766,776.4376,418.6957" style="stroke: #A80036; stroke-width: 1.7952314165497896;"/><line style="stroke: #A80036; stroke-width: 1.7952314165497896;" x1="223.5063" x2="780.0281" y1="418.6957" y2="418.6957"/><text fill="#000000" font-family="sans-serif" font-size="23.338" lengthAdjust="spacingAndGlyphs" textLength="55.6522" x="236.0729" y="409.6012">Sync</text><rect fill="#FBFB77" filter="url(#f1nymm6qx9hc0t)" height="95.1473" style="stroke: #A80036; stroke-width: 1.7952314165497896;" width="606.7882" x="202.8612" y="454.6003"/><text fill="#000000" font-family="sans-serif" font-size="23.338" lengthAdjust="spacingAndGlyphs" textLength="418.2889" x="297.5596" y="483.4441">Simultaneously establish connection</text><text fill="#000000" font-family="sans-serif" font-size="23.338" lengthAdjust="spacingAndGlyphs" textLength="183.1136" x="297.5596" y="510.611">- A after 1/2 RTT</text><text fill="#000000" font-family="sans-serif" font-size="23.338" lengthAdjust="spacingAndGlyphs" textLength="271.0799" x="297.5596" y="537.7779">- B when receiving Sync</text><polygon fill="#A80036" points="243.2539,590.1964,225.3015,597.3773,243.2539,604.5582,236.0729,597.3773" style="stroke: #A80036; stroke-width: 1.7952314165497896;"/><polygon fill="#A80036" points="769.2567,590.1964,787.209,597.3773,769.2567,604.5582,776.4376,597.3773" style="stroke: #A80036; stroke-width: 1.7952314165497896;"/><line style="stroke: #A80036; stroke-width: 1.7952314165497896;" x1="232.4825" x2="780.0281" y1="597.3773" y2="597.3773"/><text fill="#000000" font-family="sans-serif" font-size="23.338" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="524.2076" x="254.0252" y="588.2828">Attempt direct connection / Hole Punch</text><!--MD5=[8aecf1dc51134bb3d056f1631d1d3476]
@startuml
scale 1280 width
participant A
participant Relay
participant B


group A and B coordinate dial via Direct Connection Upgrade through Relay (DCUtR) Protocol
        loop Until direct connection established
                group Via relayed connection
                        A -> B: Connect { addresses }
                        rnote over A: Measure round-trip time
                        B -> A: Connect { addresses }
                        A -> B: Sync
                end
                rnote over A, B: Simultaneously establish connection\n- A after 1/2 RTT\n- B when receiving Sync
                A <-> B: **Attempt direct connection / Hole Punch**
        end
end

@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.14+9-post-Debian-1deb11u1
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>