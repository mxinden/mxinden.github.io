<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="656.9718px" preserveAspectRatio="none" style="width:1287px;height:656px;" version="1.1" viewBox="0 0 1287 656" width="1287.6647px" zoomAndPan="magnify"><defs><filter height="300%" id="f1418ubhky8g4x" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="4.379811804961506"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="8.759623609923011" dy="8.759623609923011" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1418ubhky8g4x)" height="394.0291" style="stroke: #000000; stroke-width: 4.379811804961506;" width="1236.2019" x="28.4688" y="129.8546"/><rect fill="#FFFFFF" filter="url(#f1418ubhky8g4x)" height="228.9136" style="stroke: #000000; stroke-width: 4.379811804961506;" width="935.0898" x="50.3678" y="182.7032"/><line style="stroke: #A80036; stroke-width: 2.189905902480753; stroke-dasharray: 5.0,5.0;" x1="131.3944" x2="131.3944" y1="92.6262" y2="561.1121"/><line style="stroke: #A80036; stroke-width: 2.189905902480753; stroke-dasharray: 5.0,5.0;" x1="471.9247" x2="471.9247" y1="92.6262" y2="561.1121"/><line style="stroke: #A80036; stroke-width: 2.189905902480753; stroke-dasharray: 5.0,5.0;" x1="1124.5167" x2="1124.5167" y1="92.6262" y2="561.1121"/><rect fill="#FEFECE" filter="url(#f1418ubhky8g4x)" height="66.3473" style="stroke: #A80036; stroke-width: 3.284858853721129;" width="111.6852" x="72.2669" y="15.3293"/><text fill="#000000" font-family="sans-serif" font-size="30.6587" lengthAdjust="spacingAndGlyphs" textLength="81.0265" x="87.5962" y="59.1168">Relay</text><rect fill="#FEFECE" filter="url(#f1418ubhky8g4x)" height="66.3473" style="stroke: #A80036; stroke-width: 3.284858853721129;" width="111.6852" x="72.2669" y="558.9222"/><text fill="#000000" font-family="sans-serif" font-size="30.6587" lengthAdjust="spacingAndGlyphs" textLength="81.0265" x="87.5962" y="602.7096">Relay</text><rect fill="#FEFECE" filter="url(#f1418ubhky8g4x)" height="66.3473" style="stroke: #A80036; stroke-width: 3.284858853721129;" width="52.5577" x="441.266" y="15.3293"/><text fill="#000000" font-family="sans-serif" font-size="30.6587" lengthAdjust="spacingAndGlyphs" textLength="21.8991" x="456.5954" y="59.1168">B</text><rect fill="#FEFECE" filter="url(#f1418ubhky8g4x)" height="66.3473" style="stroke: #A80036; stroke-width: 3.284858853721129;" width="52.5577" x="441.266" y="558.9222"/><text fill="#000000" font-family="sans-serif" font-size="30.6587" lengthAdjust="spacingAndGlyphs" textLength="21.8991" x="456.5954" y="602.7096">B</text><rect fill="#FEFECE" filter="url(#f1418ubhky8g4x)" height="66.3473" style="stroke: #A80036; stroke-width: 3.284858853721129;" width="218.9906" x="1015.0214" y="6.5697"/><rect fill="#FEFECE" filter="url(#f1418ubhky8g4x)" height="66.3473" style="stroke: #A80036; stroke-width: 3.284858853721129;" width="218.9906" x="1006.2618" y="15.3293"/><text fill="#000000" font-family="sans-serif" font-size="30.6587" lengthAdjust="spacingAndGlyphs" textLength="188.3319" x="1021.5911" y="59.1168">Other_Peers</text><rect fill="#FEFECE" filter="url(#f1418ubhky8g4x)" height="66.3473" style="stroke: #A80036; stroke-width: 3.284858853721129;" width="218.9906" x="1015.0214" y="558.9222"/><rect fill="#FEFECE" filter="url(#f1418ubhky8g4x)" height="66.3473" style="stroke: #A80036; stroke-width: 3.284858853721129;" width="218.9906" x="1006.2618" y="567.6818"/><text fill="#000000" font-family="sans-serif" font-size="30.6587" lengthAdjust="spacingAndGlyphs" textLength="188.3319" x="1021.5911" y="611.4692">Other_Peers</text><path d="M28.4688,129.8546 L996.4072,129.8546 L996.4072,145.1839 L974.5081,167.083 L28.4688,167.083 L28.4688,129.8546 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 2.189905902480753;"/><rect fill="none" height="394.0291" style="stroke: #000000; stroke-width: 4.379811804961506;" width="1236.2019" x="28.4688" y="129.8546"/><text fill="#000000" font-family="sans-serif" font-size="28.4688" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="869.3926" x="61.3174" y="158.4698">B listening for incoming connections via closest Relay</text><path d="M50.3678,182.7032 L974.5081,182.7032 L974.5081,198.0325 L952.6091,219.9316 L50.3678,219.9316 L50.3678,182.7032 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 2.189905902480753;"/><rect fill="none" height="228.9136" style="stroke: #000000; stroke-width: 4.379811804961506;" width="935.0898" x="50.3678" y="182.7032"/><text fill="#000000" font-family="sans-serif" font-size="28.4688" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="825.5945" x="83.2164" y="211.3184">For each closest Relay via Circuit Relay v2 Protocol</text><polygon fill="#A80036" points="156.5783,257.7417,134.6792,266.5013,156.5783,275.2609,147.8186,266.5013" style="stroke: #A80036; stroke-width: 2.189905902480753;"/><line style="stroke: #A80036; stroke-width: 2.189905902480753;" x1="143.4388" x2="469.7348" y1="266.5013" y2="266.5013"/><text fill="#000000" font-family="sans-serif" font-size="28.4688" lengthAdjust="spacingAndGlyphs" textLength="286.8777" x="169.7177" y="255.4074">Establish connection</text><polygon fill="#A80036" points="156.5783,321.5398,134.6792,330.2994,156.5783,339.059,147.8186,330.2994" style="stroke: #A80036; stroke-width: 2.189905902480753;"/><line style="stroke: #A80036; stroke-width: 2.189905902480753;" x1="143.4388" x2="469.7348" y1="330.2994" y2="330.2994"/><text fill="#000000" font-family="sans-serif" font-size="28.4688" lengthAdjust="spacingAndGlyphs" textLength="280.308" x="169.7177" y="319.2055">Request reservation</text><polygon fill="#A80036" points="445.6459,385.3379,467.5449,394.0975,445.6459,402.8571,454.4055,394.0975" style="stroke: #A80036; stroke-width: 2.189905902480753;"/><line style="stroke: #A80036; stroke-width: 2.189905902480753;" x1="132.4893" x2="458.7853" y1="394.0975" y2="394.0975"/><text fill="#000000" font-family="sans-serif" font-size="28.4688" lengthAdjust="spacingAndGlyphs" textLength="262.7887" x="147.8186" y="383.0036">Accept reservation</text><polygon fill="#A80036" points="1098.2378,497.6048,1120.1369,506.3644,1098.2378,515.124,1106.9974,506.3644" style="stroke: #A80036; stroke-width: 2.189905902480753;"/><line style="stroke: #A80036; stroke-width: 2.189905902480753;" x1="471.9247" x2="1111.3772" y1="506.3644" y2="506.3644"/><text fill="#000000" font-family="sans-serif" font-size="28.4688" lengthAdjust="spacingAndGlyphs" textLength="282.4979" x="487.2541" y="462.1311">Advertise oneself as</text><text fill="#000000" font-family="sans-serif" font-size="28.4688" lengthAdjust="spacingAndGlyphs" textLength="600.0342" x="487.2541" y="495.2705">/&lt;RELAY_ADDR&gt;/p2p-circuit/&lt;PEER_ID_B&gt;</text><!--MD5=[5278281a45c7a3675f87686599c05c69]
@startuml
scale 1280 width
participant Relay
participant B
collections Other_Peers

group B listening for incoming connections via closest Relay
        group For each closest Relay via Circuit Relay v2 Protocol
                B -> Relay: Establish connection
                B -> Relay: Request reservation
                Relay -> B: Accept reservation
        end
        B -> Other_Peers: Advertise oneself as\n/<RELAY_ADDR>/p2p-circuit/<PEER_ID_B>
end

@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.14+9-post-Debian-1deb11u1
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>